<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Authenticating...</title>
    <script>
        (function() {
            // Parse both hash and search parameters
            function getAuthParams() {
                const params = {};
                
                // Parse hash parameters
                if (window.location.hash) {
                    window.location.hash.substring(1).split('&').forEach(pair => {
                        const [key, value] = pair.split('=');
                        if (key && value) {
                            params[decodeURIComponent(key)] = decodeURIComponent(value);
                        }
                    });
                }
                
                // Parse search parameters
                if (window.location.search) {
                    window.location.search.substring(1).split('&').forEach(pair => {
                        const [key, value] = pair.split('=');
                        if (key && value) {
                            params[decodeURIComponent(key)] = decodeURIComponent(value);
                        }
                    });
                }
                
                return params;
            }

            // Get all parameters
            const params = getAuthParams();
            const baseUrl = window.location.origin + '/dart-naujas-btcz.rock';

            if (params.access_token) {
                // Store the token in both locations for compatibility
                localStorage.setItem('github-token', params.access_token);
                localStorage.setItem('netlify-cms-user', JSON.stringify({
                    token: params.access_token,
                    provider: 'github'
                }));
                
                // Clean URL and redirect
                window.location.href = baseUrl + '/admin/';
            } else if (params.error) {
                // Handle specific error cases
                console.error('Authentication error:', params.error);
                console.error('Error description:', params.error_description);
                window.location.href = baseUrl + '/admin/#error=' + encodeURIComponent(params.error);
            } else {
                // No token or error found
                console.error('No access token or error found in response');
                window.location.href = baseUrl + '/admin/#error=invalid_response';
            }
        })();
    </script>
</head>
<body>
    <h1>Authenticating...</h1>
    <p>Please wait while we complete the authentication process...</p>
    <div id="error" style="color: red; display: none;">
        <p>Authentication failed. You will be redirected back to the login page.</p>
    </div>
</body>
</html>